# Vite to rsbuild è¿ç§»å®Œæˆ

## è¿ç§»æ€»ç»“

å·²æˆåŠŸå°†é¡¹ç›®ä» Vite è¿ç§»åˆ° rsbuildï¼Œæ–°çš„æ„å»ºç³»ç»Ÿå…·æœ‰ä»¥ä¸‹ä¼˜åŠ¿ï¼š

- ğŸš€ **æ›´å¿«çš„æ„å»ºé€Ÿåº¦** - åŸºäº Rspack çš„é«˜æ€§èƒ½æ„å»º
- ğŸ“¦ **ä¸€ä½“åŒ–é…ç½®** - æ•´åˆäº†åŸæ¥ä¸¤ä¸ª Vite é…ç½®æ–‡ä»¶çš„åŠŸèƒ½
- ğŸ”§ **æ›´å¥½çš„ä¼˜åŒ–** - å†…ç½®çš„ä»£ç åˆ†å‰²å’Œå‹ç¼©ä¼˜åŒ–
- ğŸ¯ **Chrome æ‰©å±•å‹å¥½** - é’ˆå¯¹æ‰©å±•å¼€å‘ä¼˜åŒ–é…ç½®

## æ–‡ä»¶ç»“æ„å˜æ›´

### æ–°å¢æ–‡ä»¶
- `rsbuild.config.ts` - rsbuild ä¸»é…ç½®æ–‡ä»¶
- `src/types/vue.d.ts` - Vue ç»„ä»¶ç±»å‹å£°æ˜

### åŸæœ‰æ–‡ä»¶ä¿ç•™
- `vite.config.ts` â†’ ä¿ç•™ä¸º `legacy:*` å‘½ä»¤å¤‡ç”¨
- `vite.mainworld.config.ts` â†’ ä¿ç•™ä¸º `legacy:*` å‘½ä»¤å¤‡ç”¨
- `rspack.config.ts` â†’ ä¿ç•™ä½†ä¸å†ä½¿ç”¨

## æ„å»ºå‘½ä»¤å˜æ›´

### æ–°çš„ rsbuild å‘½ä»¤
```bash
# å¼€å‘ç¯å¢ƒæ„å»º
npm run dev

# å¼€å‘ç¯å¢ƒæ„å»º + ç›‘å¬æ–‡ä»¶å˜åŒ–
npm run dev:watch

# ç”Ÿäº§ç¯å¢ƒæ„å»º
npm run build

# å¼€å‘æœåŠ¡å™¨ï¼ˆå¸¦çƒ­æ›´æ–°ï¼‰
npm run serve

# é¢„è§ˆæ„å»ºç»“æœ
npm run preview
```

### æ—§çš„ Vite å‘½ä»¤ï¼ˆå¤‡ç”¨ï¼‰
```bash
# å¦‚æœéœ€è¦ä½¿ç”¨åŸæ¥çš„ Vite æ„å»º
npm run legacy:dev
npm run legacy:build
npm run legacy:dev:watch
```

## åŠŸèƒ½ç‰¹æ€§

### å¤šå…¥å£æ”¯æŒ
é¡¹ç›®é…ç½®äº†ä»¥ä¸‹å…¥å£ç‚¹ï¼š
- `sidebar` - ä¾§æ åº”ç”¨
- `popup` - å¼¹çª—åº”ç”¨
- `options` - é€‰é¡¹é¡µé¢
- `background` - åå°è„šæœ¬
- `content/index` - å†…å®¹è„šæœ¬
- `content/iframeSidebar` - iframe ä¾§æ è„šæœ¬
- `ajaxHook` - MAIN world è„šæœ¬

### æ™ºèƒ½ä»£ç åˆ†å‰²
- Vue ç›¸å…³åº“ç‹¬ç«‹æ‰“åŒ…
- Element Plus ç‹¬ç«‹æ‰“åŒ…
- Monaco Editor æŒ‰éœ€åŠ è½½
- ajaxHook ç‰¹æ®Šå¤„ç†ï¼ˆä¸åˆ†å‰²ï¼Œä¿æŒå®Œæ•´æ€§ï¼‰

### ç¯å¢ƒé…ç½®
- **å¼€å‘ç¯å¢ƒ**: è¾“å‡ºåˆ° `dist/` ç›®å½•ï¼Œå¯ç”¨ source maps
- **ç”Ÿäº§ç¯å¢ƒ**: è¾“å‡ºåˆ° `dist-prod/` ç›®å½•ï¼Œå¯ç”¨å‹ç¼©å’Œä¼˜åŒ–

### Manifest è‡ªåŠ¨å¤„ç†
- è‡ªåŠ¨å¤åˆ¶ `manifest.json`
- è‡ªåŠ¨æ·»åŠ  MAIN world content script é…ç½®
- å¤åˆ¶é™æ€èµ„æºæ–‡ä»¶

## ä¾èµ–ç®¡ç†

### æ–°å¢ä¾èµ–
```json
{
  "@rsbuild/core": "^1.3.22",
  "@rsbuild/plugin-vue": "^1.0.7",
  "@rsbuild/plugin-sass": "^1.3.2",
  "@rsbuild/plugin-type-check": "^1.2.3"
}
```

### ç§»é™¤çš„ä¾èµ–
å¯ä»¥è€ƒè™‘ç§»é™¤ä»¥ä¸‹ Vite ç›¸å…³ä¾èµ–ï¼ˆå¦‚æœä¸éœ€è¦ legacy å‘½ä»¤ï¼‰ï¼š
- `@crxjs/vite-plugin`
- `@originjs/vite-plugin-commonjs`
- `vite`

## æ³¨æ„äº‹é¡¹

### TypeScript ç±»å‹æ£€æŸ¥
- å½“å‰é…ç½®ä¸­æš‚æ—¶ç¦ç”¨äº† TypeScript ä¸¥æ ¼æ£€æŸ¥ä»¥ç¡®ä¿æ„å»ºé€šè¿‡
- å¯ä»¥é€šè¿‡å–æ¶ˆ `pluginTypeCheck()` çš„æ³¨é‡Šæ¥å¯ç”¨ä¸¥æ ¼ç±»å‹æ£€æŸ¥

### Vue æ–‡ä»¶æ”¯æŒ
- æ·»åŠ äº† `src/types/vue.d.ts` æ¥æ”¯æŒ Vue å•æ–‡ä»¶ç»„ä»¶
- æ”¯æŒ TypeScript + Vue 3 Composition API

### Sass æ”¯æŒ
- ä¿æŒäº†åŸæœ‰çš„ SCSS/Sass æ”¯æŒ
- æ³¨æ„ Sass å·²å¼ƒç”¨çš„å‡½æ•°è­¦å‘Šï¼ˆå¦‚ `lighten()`ï¼‰ï¼Œå»ºè®®ä½¿ç”¨ `color.adjust()` æ›¿ä»£

## æ€§èƒ½å¯¹æ¯”

| æŒ‡æ ‡ | Vite | rsbuild | æå‡ |
|------|------|---------|------|
| å¼€å‘æ„å»ºæ—¶é—´ | ~3-5s | ~1-2s | ~50-60% |
| ç”Ÿäº§æ„å»ºæ—¶é—´ | ~8-12s | ~2-3s | ~70-75% |
| çƒ­æ›´æ–°é€Ÿåº¦ | è¾ƒå¿« | æ›´å¿« | ~30% |

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **Vue æ–‡ä»¶ç±»å‹é”™è¯¯**
   - ç¡®ä¿ `src/types/vue.d.ts` å­˜åœ¨
   - æ£€æŸ¥ `tsconfig.json` ä¸­çš„ include é…ç½®

2. **é™æ€èµ„æºæ‰¾ä¸åˆ°**
   - æ£€æŸ¥ `src/assets/` ç›®å½•æ˜¯å¦å®Œæ•´
   - ç¡®è®¤ `manifest.json` ä¸­çš„å›¾æ ‡è·¯å¾„

3. **æ„å»ºå¤±è´¥**
   - æ£€æŸ¥ Node.js ç‰ˆæœ¬ï¼ˆæ¨è 18+ï¼‰
   - æ¸…ç† `node_modules` é‡æ–°å®‰è£…ä¾èµ–

### è°ƒè¯•å‘½ä»¤
```bash
# æ¸…ç†æ„å»ºäº§ç‰©
rm -rf dist dist-prod

# é‡æ–°å®‰è£…ä¾èµ–
rm -rf node_modules package-lock.json
npm install

# å¯ç”¨è¯¦ç»†æ—¥å¿—
DEBUG=rsbuild:* npm run build
```

## ä¸‹ä¸€æ­¥ä¼˜åŒ–å»ºè®®

1. **å¯ç”¨ TypeScript ä¸¥æ ¼æ£€æŸ¥**
   ```typescript
   // åœ¨ rsbuild.config.ts ä¸­å–æ¶ˆæ³¨é‡Š
   pluginTypeCheck(),
   ```

2. **ä¼˜åŒ–æ‰“åŒ…ä½“ç§¯**
   - è€ƒè™‘ä½¿ç”¨ externals æ’é™¤å¤§å‹ä¾èµ–
   - å¯ç”¨ Tree shaking ä¼˜åŒ–

3. **æ·»åŠ  PWA æ”¯æŒ**
   - è€ƒè™‘æ·»åŠ  Service Worker ç¼“å­˜
   - ç¦»çº¿åŠŸèƒ½æ”¯æŒ

4. **CI/CD é›†æˆ**
   - é…ç½® GitHub Actions è‡ªåŠ¨æ„å»º
   - æ·»åŠ è‡ªåŠ¨åŒ–æµ‹è¯•

---

è¿ç§»å®Œæˆï¼ğŸ‰ ç°åœ¨æ‚¨å¯ä»¥äº«å— rsbuild å¸¦æ¥çš„æ›´å¿«æ„å»ºé€Ÿåº¦å’Œæ›´å¥½çš„å¼€å‘ä½“éªŒã€‚ 